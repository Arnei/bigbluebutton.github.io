---
layout: page
title: "Install"
category: 1.1
date: 2016-12-08 22:13:42
---

Welcome to the installation guide for **BigBlueButton 1.1-beta** (referred hereafter as BigBlueButton 1.1).  

BigBlueButton is an open source web conferencing system for online learning.  The goal of the project is to enable teachers to engage remote students in a high-quality online learning experience.  

BigBlueButton 1.1, our latest release, offers faster desktop sharing, closed captioning, and breakout rooms (see [overview of BigBlueButton 1.1-beta](/1.1/overview.html) for details).  

This document is for system administrators and developers wanting to setup and install BigBlueButton 1.1.  Specifically, it covers installation of BigBlueButton on a Ubuntu 16.04 64-bit server, configuring BigBlueButton to use a hostname and SSL certificate, and, if BigBlueButton is running behind a firewall, configuring the firewall to pass through connections on specific ports to the BigBlueButton server.

For developers, when installing BigBlueButton a virtual machine (VM) or a Linux Container (LXD) running on a local network, you can typically skip, configuring a hostname, SSL certificate, and firewall.  Use FireFox to test as this browser does not require a SSL certificate for use with WebRTC.

For administrators, if you want to setup BigBlueButton on a public server for use by others, you will need to configure BigBlueButton with a valid hostname and SSL certificate (not a self-generated certificate).  Furthermore, if you are installing BigBlueButton behind a firewall, you will also need to configure the firewall to pass through specific connections to the BigBlueButton server (the details are given in this document).  

We recommend installing BigBlueButton 1.1 on a new Ubuntu 16.04 64-bit server; specifically, one that does not already have web applications installed (such as plesk).  Such applications create subtle conflicts with the installation and running of BigBlueButton that are difficult to resolve.

If you want to upgrade a BigBlueButton 1.0 (or earlier) server, we recommend to starting with a separate clean Ubuntu 16.04 64-bit server, install BigBlueButton 1.1 on it, and then [transfer over existing recordings](#transfer-existing-published-recordings).  

If you encounter difficulties with the installation, see [http://bigbluebutton.org/support](http://bigbluebutton.org/support) for how to engage the BigBlueButton community reach out to companies that offer commercial support and hosting for BigBlueButton.

## Installation video

To see a video walk through of

  * installing BigBlueButton 1.1 on an newly setup 16.04 64-bit server,
  * assigning a hostname, and
  * configuring the server with SSL certificate from Let's Encrypt  

click the link below:

<a href="http://www.youtube.com/watch?feature=player_embedded&v=6Saztv2WlKI
" target="_blank"><img src="/images/11-install-drop.png"
alt="Installation Video Walkthrough" border="10" /></a>

Note: If your BigBlueButton server will be running behind firewall, there are additional steps for configuring the firewall and BigBlueButton to enable and access for external users.

# Before you install

Before you type `sudo apt-get install BigBlueButton`, go through this section to make sure your server meets the minimum requirements.  

## Minimum server requirements

The minimum server requirements for installing BigBlueButton 1.1 are

  * Ubuntu 16.04 64-bit OS
  * 4 GB of memory with swap enabled (8 GB of memory is better)
  * Quad-core 2.6 GHZ CPU (or faster)
  * TCP ports 80, 443,and 1935 are accessible
  * TCP port 7443 is accessible if you intend to configure SSL (recommended), otherwise port 5066 is accessible
  * UDP ports 16384 - 32768 are accessible
  * Port 80 is **not** in use by another application

Other recommendations are

  * 500G of free disk space (or more) for recordings
  * 100 Mbits/sec bandwidth (symmetrical)
  * Dedicated (bare metal) hardware (not virtualized)

Why do we recommend a bare metal server?  BigBlueButton uses FreeSWITCH for processing of incoming audio packets and FreeSWITCH works best in a non-virtualized environment (see [FreeSWITCH recommended configurations](https://freeswitch.org/confluence/display/FREESWITCH/Performance+Testing+and+Configurations#PerformanceTestingandConfigurations-RecommendedConfigurations)).  You can still run BigBlueButton on a virtual server (such as shown in the [install video](#installation-video)), but you'll get best performance on dedicated hardware.  

If you are a developer setting up a BigBlueButton server for dev and testing, you don't need 500G free for such recordings (40G would be more than sufficient).  

What about bandwidth for users? For end-user accessing the BigBlueButton server we recommend (a minimum of) 1.0 Mbits/sec download speed and 0.5 Mbits/sec upload speed.  If the presenter intends to share his or her desktop, then we recommend (a minimum of) 1.0 Mbits/sec upload speed.

## Check server specs

Got a Ubuntu 16.04 64-bit server setup?  Great, let's run through some quicks configuration checks to make sure the server is ready for an error-free install.  Doing these quick steps will save time later on.  

First, check that the locale of the server is `en_US.UTF-8`.  To check the locale, enter the following command and check its output matches `LANG="en_US.UTF-8`.

~~~
$ cat /etc/default/locale
LANG="en_US.UTF-8"
~~~

If you don't see `LANG="en_US.UTF-8"`, then enter the following commands to set the local to `en_US.UTF-8`.

~~~
$ sudo apt-get install language-pack-en
$ sudo update-locale LANG=en_US.UTF-8
~~~

Next, logout and then log back into your SSH session -- this will reload the locale configuration for your session -- and run the above command `cat /etc/default/locale` again.  Verify you see only the single line `LANG="en_US.UTF-8"`.  

Note: If you see an additional line `LC_ALL=en_US.UTF-8`, then remove the entry for `LC_ALL` from `/etc/default/locale` and logout and then log back in once more.

Next, check that your server has (at lest) 4G of memory using the command `free -h`.  Here's the output from one of our test servers.

~~~
$ free -h
              total        used        free      shared  buff/cache   available
Mem:            31G        5.9G        314M        1.8G         25G         21G
Swap:           31G        360M         31G
~~~

If you see a value for `Mem:` in the `total` column less than 4G (the above example is showing 31G), then your server has insufficient memory to run BigBlueButton.  You need to increase the server's memory to (at least) 4G.

Next, check that the server has Ubuntu is 16.04.  

~~~
$  cat /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04.x LTS"
~~~

Next, check that your server is running the 64-bit version of Ubuntu 16.04.

~~~
$ uname -m
x86_64
~~~

We (the core developers) have designed, developed, installed, and tested BigBlueButton 1.1 on Ubuntu: 16.04 64-bit (Xenial Xerus).  That's what we recommend you use.  We have not tested BigBlueButton 1.1 on any other version of Ubuntu (or Linux).

Why the focus on Ubuntu 16.04?  It's a choice of quality over quantity.  Long ago we concluded that its better for the project to have solid, well-tested, well-documented installation for a specific version of Linux that works really, really well than to try and support may OS and have none of them work well.  

## Have a Hostname and SSL certificate

(If you are a developer setting up BigBlueButton on a local VM for yourself only, then you can likely skip this section.)

We recommend assigning your BigBlueButton server a fully qualified domain name (FQDN), such as `bigbluebutton.example.com`, and configuring that server with secure sockets layer (SSL) certificate.  Doing this will enable nginx, the web server that gets installed with BigBlueButton, to serve content via secure hypertext transfer protocol (HTTPS).  With having HTTPS enabled, some browsers will not let the use share their web cam or microphone.  Furthermore, the browsers will complain about insecure content.

In short, on any server used in production, setup of a domain name and valid SSL certificate is a must.

For obtaining a domain name, there are many good domain name registrars such as [GoDadday](https://godaddy.com/) and [Network Solutions](https://www.networksolutions.com/).  

For obtaining a SSL certificate, after you install BigBlueButton, there is more detailed information in the section [Obtain an SSL certificate](#obtain-an-ssl-certificate).

## Configure the firewall (if required)

(Again, if you are a developer setting up BigBlueButton on a local VM for testing, you can likely skip this section).

The simplest network configuration for a BigBlueButton server is the server has a single external IP address, the server is on the public Internet (and thus directly accessible by your users), and there is no firewall (virtual or physical) between users an the server.  Here is an example of such a setup with the BigBlueButton server having a (fictional) IP address 203.0.113.1 with hostname `bigbluebutton.example.com`.

![Install](/images/11-install-net0.png)

In this simple network configuration, BigBlueButton should work out-of-the-box after installation.  This is because the packaging scripts automatically configure BigBlueButton using the first non-loopback IP address.    

A variation of this setup occurs when the server has multiple network interfaces, but the external IP is still the first network interface (such as eth0) picked up by the installation scripts.  

![Install](/images/11-install-net1.png)

Again, in this case, the packaging scripts will correctly configure BigBlueButton to use the external IP address and you can skip the remainder of this section and proceed to [Installing BigBlueButton](#installing-bigbluebutton-11-beta).

Don't worry if your server's IP address changes, BigBlueButton comes with a configuration utility called `bbb-conf` that lets you change all of BigBlueButton's configuration files to use any IP address or hostname.

If there is a firewall between your users and the BigBlueButton server, then you will need to first configure the firewall to forward specific connections from external clients to the internal BigBlueButton server; otherwise, users will not be able to access BigBlueButton.

The following diagram gives a typical setup with an external firewall (your setup will, of course, have different IP address and hostnames).

![Install](/images/11-install-net2.png)

In this example, all users must connect to the BigBlueButton server via the uniform resource locator (URL) `https://bigbluebutton.example.com/`.  This hostname resolves to the IP address 203.0.113.1 which is the firewall.  The firewall must forward specific connections (described below) to the BigBlueButton server running at IP address 10.0.2.12.

### Configuring your firewall
When BigBlueButton is protected behind a firewall, you need to configure the firewall to forward the following incoming connections to BigBlueButton:

  * TCP ports 80, 443, 1935, and 7443
  * UDP ports in the range 16384 - 32768

In the case where you have installed BigBlueButton on Amazon EC2, you need to add rules to the server's associated security group (which serves as a firewall) to allow the above TCP and UDP connections.

After you have made the changes, before proceeding to the installation, take a moment and test that you have configured the firewall to correctly forwarded the above connections.

### Testing the firewall

To test connections on various ports needed by BigBlueButton, you will use a tool called `netcat` to listen for connections on specific ports on the BigBlueButton server.  You'll use the same tool on a server external to the firewall to generate connections.  If the connection goes throw, then the firewall is forwarding the packets.

To test, first install `netcat` on the BigBlueButton using the following command:

~~~
$ sudo apt-get install netcat
~~~

Next, run `netcat -l 7443` to listen on port 7443

~~~
# netcat -l 7443
~~~

`netcat` is now going to echo to the terminal any text it receives on port 7443 (you can quit the command later using Ctrl-c).

Next, on a second computer that is external to the firewall -- that is, it must go through the firewall to access the BigBlueButton server -- install `netcat` as well.  Replacing `EXTERNAL_HOST_NAME` with the hostname of your firewall,  run the following command

~~~
# netcat EXTERNAL_HOST_NAME 7443
~~~

and type type the word 'test' and press ENTER.  

If the firewall is forwarding incoming connections on port 7443 to the internal BigBlueButton server, you should see the word 'test' appear after the `netcat -l 7443` command, as in

~~~
# netcat -l 7443
test
~~~

If the word `test` does not appear, double-check the firewall configuration to ensure its forwarding connections on port 7443 and then test again.  You want to see the word `test` appear before proceeding to the installation BigBlueButton.

Repeat these tests with ports 80, 443, and 1935.

That covers the TCP/IP ports.  Next, we need to test that UDP connections in the range 16384-32768 are forwarded as well.  On your BigBlueButton server, run the following `netcat` command to listen for incoming data via UDP on port 17000 (here, we're picking a port in the range 16384-32768).

~~~
# netcat -u -l 17000
~~~

Next, on a computer outside the firewall, replace `EXTERNAL_HOST_NAME` with the hostname of your firewall and run the command

~~~
# netcat -u EXTERNAL_HOST_NAME 17000
~~~

Type 'test2' into the terminal and press ENTER.  You should see the word 'test2' appear on the terminal of the BigBlueButton server, as in

~~~
# netcat -u -l 17000
test2
~~~

As before, it the above test fails, double-check the settings of the firewall to ensure its properly fording UDP packets in the range 16384-32768 and test again.

When BigBlueButton is running on a server, various component of BigBlueButton need to make connections to itself.  It should be making these connections to the firewall which, in turn, should forward the connections right back to the BigBlueButton server itself.  

To enable the BigBlueButton server to connect to itself, on the BigBlueButton server the file `/etc/hosts` and, replacing `EXTERNAL_IP_ADDRESS` with the external IP of your firewall and `EXTERNAL_HOST_NAME` with the external hostname of your firewall, add the following line.

~~~
EXTERNAL_IP_ADDRESS EXTERNAL_HOST_NAME
~~~

For example, using the configuration in our diagram, the correct line to add to `/etc/hosts` would be

~~~
172.34.56.78 bigbluebutton.example.com
~~~

# Installing BigBlueButton 1.1-beta

Before you begin the installation, here's a quick checklist to make sure you are ready:

   1. You have a Ubuntu 16.04 64-bit server that meets the [minimum specifications](#before-you-install).
   2. If the server is behind a firewall, you have [configured the firewall](#configure-the-firewall-if-required) to forward the appropriate ports to the BigBlueButton server (and tested that connections are getting through).
   3. You have a fully qualified domain name (such as `bigbluebutton.example.com`) that resolves to your BigBlueButton server's IP address (or the IP address of your firewall).
   4. You have a valid SSL certificate for the hostname.

If you are a developer setting up BigBlueButton for development or testing on a local VM, you can skip (2), (3), and (4).  In this scenario, use FireFox for testing as FireFox supports WebRTC without a requiring an SSL connection.

OK, let's get started with the installation!

## 1. Update your server

First, make sure your server is up-to-date with latest packages and security updates.   

Login to your server via SSH.  You need to have an account that can execute commands as root (via `sudo`).  Once logged in, first ensure that you have `xenail multiverse` in your `/etc/apt/sources.list` by doing the following

~~~
$ grep "multiverse" /etc/apt/sources.list
~~~

After entering the above command you should see an uncommented line for the multiverse repository, which may look like either this

~~~
deb http://archive.ubuntu.com/ubuntu xenial multiverse
~~~

or this

~~~
deb http://archive.ubuntu.com/ubuntu xenial main restricted universe multiverse
~~~

Don't worry if your hostname in the URL is different from the above, what's important is you see an uncommented link that contains `multiverse`.  If you don't, run the following command to add the multiverse repository to your `/etc/apt/sources.list` file.

~~~
$ echo "deb http://archive.ubuntu.com/ubuntu/ xenial multiverse" | sudo tee -a /etc/apt/sources.list
~~~

If you are a developer installing BigBlueButton on a VM for testing and development, some of BigBlueButton's components, such as Tomcat, need a source of entropy when starting up.  In a VM the available entropy can run low and cause Tomcat to block for a long periods of time (sometimes minutes) before finishing startup.  To give the VM lots of entropy, install a packaged called `haveged` (a simple entropy daemon):

~~~
$ sudo apt-get install haveged
~~~

If you are curious on the details behind entropy, see this [link](https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged).

Next, upgrade your server to the latest packages (and security fixes).

~~~
$ sudo apt-get update
$ sudo apt-get dist-upgrade
~~~

If you haven't updated in a while, `apt-get` may recommend you reboot your server after `dist-upgrade` finishes.  Do the reboot now before proceeding to the next step.


## 2. Install apt-get key for BigBlueButton repository

All packages for BigBlueButton are digitally signed with the projects public key.  Before installing BigBlueButton, you need to add the project's public key to your server so `apt-get` can validate the signed packages.  To do this, enter the following command:

~~~
$ wget http://ubuntu.bigbluebutton.org/repo/bigbluebutton.asc -O- | sudo apt-key add -
~~~

Next, so your server needs to know where to download the BigBlueButton packages.  To configure the package repository, enter the following command:

~~~
$ echo "deb http://ubuntu.bigbluebutton.org/xenial-110/ bigbluebutton-xenial main" | sudo tee /etc/apt/sources.list.d/bigbluebutton.list
~~~

Finally, run `apt-get` to pull down the links to the latest BigBlueButton packages.

~~~
$ sudo apt-get update
~~~


## 3.  Install BigBlueButton

We're now ready to install BigBlueButton.

~~~
$ sudo apt-get install bigbluebutton
~~~

That's it.  One command.  This single command will install **all** of BigBlueButton's core components along with all it's necessary dependencies.  

![Install](/images/11-install.png)

When prompted to proceed, type 'Y' and press ENTER.

Note: During install, you may see an error "Failure to download extra data files" for the `ttf-mscorefonts-installer` package.  This is a [known issue](https://bugs.launchpad.net/ubuntu/+source/aptitude/+bug/1543280) with Ubuntu 16.04.  You can ignore this error.

If the installation exits with an error before finishing, go through the checks in [Before you install](#before-you-install) to see if there is a configuration error with the server.  If you find an resolve any configuration errors, you can attempt to finish the installation using the command `sudo apt-get install -f`.

After the installation finishes, restart all the BigBlueButton services in proper sequence using the following command:

~~~
$ bbb-conf --restart
~~~

Next, run the BigBlueButton configuration utility `bbb-conf --check`.  This utility checks BigBlueButton's configuration and log files and looks for any potential errors that may cause problems when running.

You should see output similar to the following (of course with a different IP address than 10.0.3.192).

~~~
$ bbb-conf --check

BigBlueButton Server 1.1.0-beta (NNN)
                    Kernel version: 4.4.0-47-generic
                      Distribution: Ubuntu 16.04.N LTS (64-bit)
                            Memory: NNNN MB

/var/www/bigbluebutton/client/conf/config.xml (bbb-client)
                Port test (tunnel): 10.0.3.192
                              red5: 10.0.3.192
              useWebrtcIfAvailable: true

/opt/freeswitch/etc/freeswitch/sip_profiles/external.xml (FreeSWITCH)
                    websocket port: 5066
                    WebRTC enabled: true

/etc/nginx/sites-available/bigbluebutton (nginx)
                       server name: 10.0.3.192
                              port: 80
                    bbb-client dir: /var/www/bigbluebutton

/var/lib/tomcat7/webapps/bigbluebutton/WEB-INF/classes/bigbluebutton.properties (bbb-web)
                      bbb-web host: 10.0.3.192

/var/lib/tomcat7/webapps/demo/bbb_api_conf.jsp (API demos)
                               url: 10.0.3.192

/var/www/bigbluebutton/check/conf/config.xml (client check)
                      client check: 10.0.3.192

/usr/share/red5/webapps/bigbluebutton/WEB-INF/red5-web.xml (red5)
                  voice conference: FreeSWITCH

/usr/local/bigbluebutton/core/scripts/bigbluebutton.yml (record and playback)
                     playback host: 10.0.3.192


** Potential problems described below **
~~~   

Any output that followed `Potential problems` **may** indicate configuration errors or installation errors.  In many cases, the messages will give you recommendations on how to resolve the issue.  

At this point, your BigBlueButton server is listening to an IP address.  If your a developer setting up a VM for testing/development and just want to use the IP address without a hostname, skip to the section [API demos](#install-api-demos-optional).

### Assign a hostname

For any production BigBlueButton server, you need to assign it a hostname.  If you have not done so already, use the web interface provided by your domain name service (DNS) provider and add an `A record` pointing to your server's IP address (see the documentation for your DNS provider on how to do this step).  

After the `A record` is setup, enter the following command and `EXTERNAL_HOST_NAME` with the hostname of your BigBlueButton server.

~~~
$ ping EXTERNAL_HOST_NAME
~~~

Here's an example of the output using `demo.bigbluebutton.org`:

~~~
$ ping demo.bigbluebutton.org
PING demo.bigbluebutton.org (146.20.105.32) 56(84) bytes of data.
64 bytes from 146.20.105.32: icmp_seq=1 ttl=44 time=27.5 ms
~~~

Note: If your server doesn't allow ICMP traffic, then no bytes will be returned, but you should see your server's IP address returned in the brackets () after the hostname.

If the hostname is resolving to the server's IP address (or the IP address of the firewall), next use the BigBlueButton configuration utility `bbb-conf` to update BigBlueButton's configuration files to use this hostname.

~~~
$ bbb-conf --setip HOSTNAME
~~~

For example, if your hostname was `bigbluebutton.example.com`, the command would be

~~~
$ bbb-conf --setip bigbluebutton.example.com
~~~

At this point, you have BigBlueButton server listening to an IP address (or hostname) and responding to API requests.  However, if you tried to login from the server's default page with a browser, you would get an error `HTTP Status 404 - /demo/demo1.jsp`.  

Why?  This page requires the API demos installed.  We'll cover installing the API demos in the next step.

However, you may not need the demos if you are intending to use another [front-end](http://bigbluebutton.org/open-source-integrations/) for the BigBlueButton server.  For example, if you have a Moodle server and you want to configure the [BigBlueButton Moodle Plugin](https://moodle.org/plugins/mod_bigbluebuttonbn) to access the BigBlueButton server, you don't need to install the API demos.

To configure the Moodle (and other) integrations with BigBlueButton, use `bbb-conf --secret` tool to get your BigBlueButton server's URL and shared secret.

~~~
$ bbb-conf --secret

       URL: http://bigbluebutton.example.com/bigbluebutton/
    Secret: a7007506f1efffa497922fc34e3184dc
~~~


## 4. Install API Demos (optional)

If you want to login to your BigBlueButton server through the landing page, install the API demos using the command

~~~
$ sudo apt-get install bbb-demo
~~~

Once installed, you'll be able to enter your name on the home page and click 'Join'.  This will join you into the default meeting called "Demo Meeting".  You can also check out the other examples by clicking the `API examples` link on the home page.  These are the same API demos installed at [http://demo.bigbluebutton.org](http://demo.bigbluebutton.org).

If you are setting up a production server with custom front-end, you may want to temporarily install the API demos for testing only.

Later on, to remove the API demos, enter the command:

~~~
$ sudo apt-get purge bbb-demo
~~~

To learn more about integrating BigBlueButton with your application, check out the [BigBlueButton API documentation](http://docs.bigbluebutton.org/dev/api.html).


## 5. Install client self-check (optional)

BigBlueButton provides an end-user self-check application that can help you diagnose networking and configuration issues that may be preventing an end-user from accessing the server.  

To install the end-user self-check application, enter the command

~~~
$ sudo apt-get install bbb-check
~~~

The self-check application is available at your BigBlueButton server's IP address (or hostname) with `/check` appended.  For example, you can try out the self-check application on the BigBlueButton demo server at [http://demo.bigbluebutton.org/check](http://demo.bigbluebutton.org/check).

Later on, if you wish to remove the end-user self-check page, enter the command

~~~
$ sudo apt-get purge bbb-check
~~~

## 6. Restart your server

You can restart and check your BigBlueButton server at any time using the commands

~~~
$ sudo bbb-conf --restart
$ sudo bbb-conf --check
~~~

The `bbb-conf --check` scans some of the log files for error messages.  If you've done a number of configuration changes on your server, you can clear out all the log files and check the server using the `--clean` option, as in

~~~
$ sudo bbb-conf --clean
$ sudo bbb-conf --check
~~~

Here is a sample output from running `sudo bbb-conf --check` on demo.bigbluebutton.org.  This server has a SSL certificate as well.

~~~
$ bbb-conf --check

BigBlueButton Server 1.1.0-beta (NNN)
                    Kernel version: 4.4.0-28-generic
                      Distribution: Ubuntu 16.04.1 LTS (64-bit)
                            Memory: 7982 MB

/var/www/bigbluebutton/client/conf/config.xml (bbb-client)
                Port test (tunnel): demo.bigbluebutton.org
                              red5: demo.bigbluebutton.org
              useWebrtcIfAvailable: true

/opt/freeswitch/etc/freeswitch/sip_profiles/external.xml (FreeSWITCH)
                    websocket port: 7443
                    WebRTC enabled: true

/etc/nginx/sites-available/bigbluebutton (nginx)
                       server name: demo.bigbluebutton.org
                              port: 80, [::]:80
                              port: 443 ssl
                    bbb-client dir: /var/www/bigbluebutton

/var/lib/tomcat7/webapps/bigbluebutton/WEB-INF/classes/bigbluebutton.properties (bbb-web)
                      bbb-web host: demo.bigbluebutton.org

/var/lib/tomcat7/webapps/demo/bbb_api_conf.jsp (API demos)
                               url: demo.bigbluebutton.org

/usr/share/red5/webapps/bigbluebutton/WEB-INF/red5-web.xml (red5)
                  voice conference: FreeSWITCH

/usr/local/bigbluebutton/core/scripts/bigbluebutton.yml (record and playback)
                     playback host: demo.bigbluebutton.org



** Potential problems described below **
# Warning: The API demos are installed and accessible from:
#
#    https://demo.bigbluebutton.org/demo/demo1.jsp
#
# These API demos allow anyone to access your server without authentication
# to create/manage meetings and recordings. They are for testing purposes only.
# If you are running a production system, remove them by running:
#
#    sudo apt-get purge bbb-demo
~~~

Notice that `sudo bbb-conf --check` warns you the API demos installed, which enable anyone with access the server to launch a session.

If you see other warning messages check out the [troubleshooting installation](#troubleshooting-installation).

With BigBlueButton installed and a hostname applied, the next steps are:

   * [configure SSL on your server](#configuring-ssl-on-your-bigbluebutton-server)
   * [configure BigBlueButton to work with your firewall](#configuring-bigbluebutton-behind-a-firewall) (if needed)

# Configuring SSL on your BigBlueButton server

You'll want to add SSL support to your BigBlueButton server to make it more secure.  Also, as of Chrome 47, Chrome users will be unable to share their microphone via WebRTC unless BigBlueButton is loaded via HTTPS.  

## Configure BigBlueButton to use a domain name

Please run all commands in this section **root**.

In order to obtain a valid SSL certificate for your server, you must have already [assigned a hostname](#assign-a-hostname) to your BigBlueButton server.

For the purposes of documentation, we will be using the domain name "example.com", with a BigBlueButton server hosted at "bigbluebutton.example.com".

Once you have a domain name and have configured it with a DNS host, add an A record pointing to your server. You can then use the [bbb-conf setip command](/install/bbb-conf.html) to configure BigBlueButton to use that domain name, for example:

~~~
# bbb-conf --setip bigbluebutton.example.com
~~~

## Obtain an SSL certificate

Before you can configure nginx on BigBlueButton to server content via HTTPS, you need to have a valid SSL certificate. A domain validated (sometimes called "class 1") certificate with a 2048 bit RSA key and SHA-256 checksum is the current recommended minimum, and it should be sufficient.

There are a number of providers that you could obtain a certificate from. Many domain name sales companies also offer certificates.

Some well known large providers of SSL certificates include Comodo, Symantec, GoDaddy, GlobalSign, and DigiCert. In addition, free SSL certificates are available from StartSSL and CACert, with some caveats: StartSSL certificates can't be revoked without paying a service fee, and most people do not have the root for CACert installed in their web browser.  

Each provider will give you a series of steps for generating the certificate, but they will normally include generating a private key and certificate request locally, sending the certificate request to be signed, and then receiving back the signed certificate after they have performed any required verification steps.

To install the certificate in BigBlueButton, you will need to have files for the certificate, private key, and any intermediate certificates in PEM format.

If you don't yet have a SSL certificate and your server is on the Internet, you can use Let's Encrypt to obtain a free renewable SSL certificate (expires after 90 days, but are automatically renewable).  If you want to use Let's Encrypt, then skip to [setup using Let's Encrypt](#using-lets-encrypt).

## Configure nginx to use HTTPS
Depending on your certificate authority (CA), you should now have 2 or more files, as follows:

* Certificate
* Private key
* Intermediate certificate (there may be more than one, or could be none)

The next step is to install the files on the server.

Create the directory `/etc/nginx/ssl`:

~~~
# mkdir /etc/nginx/ssl
~~~

And now create the private key file for nginx to use (replace the hostname in the filename with your own). In addition, fix the permissions so that only root can read the private key:

<pre><code># cat &gt;/etc/nginx/ssl/bigbluebutton.example.com.key &lt;&lt;'END'
<span style="color:#980000;font-weight:bold">Paste the contents of your key file here</span>
END
chmod 0600 /etc/nginx/ssl/bigbluebutton.example.com.key</code></pre>

And the certificate file. Note that nginx needs your server certificate and the list of intermediate certificates together in one file (replace the hostname in the filename with your own):

<pre><code># cat &gt;/etc/nginx/ssl/bigbluebutton.example.com.crt &lt;&lt;'END'
<span style="color:#980000;font-weight:bold">Paste (in order) the contents of the following files:
  1. The signed certificate from the CA
  2. In order, each intermediate certificate provided by the CA (but do not include the root).</span>
END</code></pre>

In addition, we'll generate a set of 2048-bit diffie-hellman parameters to improve security for some types of ciphers. This step can take several minutes to complete, particularly if run on a virtual machine.

~~~
# openssl dhparam -out /etc/nginx/ssl/dhp-2048.pem 2048
~~~

Now we can edit the nginx configuration to use SSL. Edit the file `/etc/nginx/sites-available/bigbluebutton` to add the marked lines. Ensure that you're using the correct filenames to match the certificate and key files you created above.

<pre><code>server {
  server_name bigbluebutton.example.com;
  listen 80;
  listen [::]:80;
  <span style="color:#980000;font-weight:bold">listen 443 ssl;
  listen [::]:443 ssl;
  ssl_certificate /etc/nginx/ssl/bigbluebutton.example.com.crt;
  ssl_certificate_key /etc/nginx/ssl/bigbluebutton.example.com.key;
  ssl_session_cache shared:SSL:10m;
  ssl_session_timeout 10m;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers "ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS:!AES256";
  ssl_prefer_server_ciphers on;
  ssl_dhparam /etc/nginx/ssl/dhp-2048.pem;</span>
  [...]</code></pre>

For reference, note that the SSL settings used above are based on those proposed in [https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/](https://hynek.me/articles/hardening-your-web-servers-ssl-ciphers/) and provide support for all modern browsers (including IE8, but not IE6, on Windows XP). Please note that recommended SSL settings are subject to change as new vulnerabilities are found.

## Configure FreeSWITCH for using WebRTC

Edit the file `/opt/freeswitch/conf/sip_profiles/external.xml` and look for a line containing "ws-binding". Change the line so it matches the following (note the change of `ws-binding` to `wss-binding` and port 5066 to 7443).

<pre><code>    &lt;param name="tls-version" value="$${sip_tls_version}"/&gt;
    <span style="color:#980000;font-weight:bold">&lt;param name="wss-binding" value=":7443"/&gt;</span></code></pre>

If you have a firewall on your server and have opened port 5066, change the rule to now open port 7443 instead.

Next, the websocket forwarding address in nginx.  Edit the file `/etc/bigbluebutton/nginx/sip.nginx` and change the protocol and port on the proxy_pass line as shown:

<pre><code>location /ws {
  proxy_pass <span style="color:#980000;font-weight:bold">https</span>://203.0.113.1:<span style="color:#980000;font-weight:bold">7443</span>;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "Upgrade";
  proxy_read_timeout 6h;
  proxy_send_timeout 6h;
  client_body_timeout 6h;
  send_timeout 6h;
}</code></pre>


## Configure BigBlueButton to load session via HTTPS

With nginx now configured to use SSL, the next step is to configure FreeSWITCH to use HTTPS for initiating an audio connection.

Edit `/var/lib/tomcat7/webapps/bigbluebutton/WEB-INF/classes/bigbluebutton.properties` and update the property `bigbluebutton.web.serverURL` to use HTTPS:

<pre><code>#----------------------------------------------------
# This URL is where the BBB client is accessible. When a user successfully
# enters a name and password, she is redirected here to load the client.
bigbluebutton.web.serverURL=<span style="color:#980000;font-weight:bold">https</span>://bigbluebutton.example.com</code></pre>

Next, edit the file `/usr/share/red5/webapps/screenshare/WEB-INF/screenshare.properties` and update the property `jnlpUrl` and `jnlpFile` to HTTPS:

<pre><code>streamBaseUrl=rtmp://freddixon.ca/screenshare
jnlpUrl=<span style="color:#980000;font-weight:bold">https</span>://bigbluebutton.example.com/screenshare
jnlpFile=<span style="color:#980000;font-weight:bold">https</span>://bigbluebutton.example.com/screenshare/screenshare.jnlp</code></pre>


You must also update the file `/var/www/bigbluebutton/client/conf/config.xml` to tell the BigBlueButton client to load components via HTTPS.  You can do the update with a single command

~~~
# sed -e 's|http://|https://|g' -i /var/www/bigbluebutton/client/conf/config.xml
~~~

If you would ever need to revert this change, you can run the reverse command:

~~~
# sed -e 's|https://|http://|g' -i /var/www/bigbluebutton/client/conf/config.xml
~~~

Next, modify the creation of recordings so they are served via HTTPS. Edit `/usr/local/bigbluebutton/core/scripts/bigbluebutton.yml` and change the value for playback_protocol as follows:

<pre><code>playback_protocol: <span style="color:#980000;font-weight:bold">https</span>
</code></pre>

If you have installed the API demos in [step 4](#install-api-demos-optional), edit `/var/lib/tomcat7/webapps/demo/bbb_api_conf.jsp` and change the value of `BigBlueButtonURL` use HTTPS.

<pre><code>// This is the URL for the BigBlueButton server
String BigBlueButtonURL = "<span style="color:#980000;font-weight:bold">https</span>://bigbluebutton.example.com/bigbluebutton/";
</code></pre>

Finally, to apply all of the configuration changes made, you must restart all components of BigBlueButton:

~~~
# bbb-conf --restart
~~~

## Test your HTTPS configuration

In order to ensure you didn't make any mistakes that could cause security compromises, please test your HTTPS configuration. A well-respected site that can do a series of automated tests is [https://www.ssllabs.com/ssltest/](https://www.ssllabs.com/ssltest/) - simply enter your server's hostname, optionally check the "Do not show results" check box if you would like to keep it private, then Submit.

At time of writing, the configuration shown on this page should achieve an "A" ranking in the SSL Labs test page.


## Using Let's Encrypt

If you have a domain name assigned to your BigBlueButton server (i.e. bigbluebutton.example.com) and the server is on the Internet, then can use Let's Encrypt to obtain a free SSL certificates.

First, install Let's Encrypt configuration tool.  Please run all commands in this section <b>root</b>.

~~~
# apt-get install letsencrypt
~~~

Next, generate a set of 2048-bit diffie-hellman parameters to improve security for some types of ciphers.

~~~
# mkdir /etc/nginx/ssl
# openssl dhparam -out /etc/nginx/ssl/dhp-2048.pem 2048
~~~

Before you can generate a certificate on your server, you need to configure BigBlueButton to use the intended hostname.  If you have not already done so, use the following command (replace `bigbluebutton.example.com` with your own DNS name), to configure the BigBlueButton server with your hostname.

~~~
# bbb-conf --setip bigbluebutton.example.com
~~~

Next, request a SSL certificate from Let's Encrypt using the `letsencrypt` tool.  Again, replace `bigbluebutton.example.com` with your hostname.

~~~
# letsencrypt --webroot -w /var/www/bigbluebutton-default/ -d bigbluebutton.example.com certonly

IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at
   /etc/letsencrypt/live/bigbluebutton.example.com/fullchain.pem. Your cert will
   expire on 20XX-YY-ZZ. To obtain a new version of the certificate in
   the future, simply run Let's Encrypt again.
 - If you like Let's Encrypt, please consider supporting our work by:

   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le

~~~

This will generate the following files

~~~
# ls /etc/letsencrypt/live/bigbluebutton.example.com/
cert.pem  chain.pem  fullchain.pem  privkey.pem
~~~

Next, edit the nginx configuration file `/etc/nginx/sites-available/bigbluebutton` and add the marked lines below. Ensure that you’re using the correct filenames to match the certificate and key files you created above (again, replace `bigbluebutton.example.com` with your hostname).

<pre><code>server {
  server_name bigbluebutton.example.com;
  listen 80;
  listen [::]:80;
  <span style="color:#980000;font-weight:bold">listen 443 ssl;
  listen [::]:443 ssl;
  ssl_certificate /etc/letsencrypt/live/bigbluebutton.example.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/bigbluebutton.example.com/privkey.pem;
  ssl_session_cache shared:SSL:10m;
  ssl_session_timeout 10m;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers "ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:ECDH+3DES:DH+3DES:RSA+AESGCM:RSA+AES:RSA+3DES:!aNULL:!MD5:!DSS:!AES256";
  ssl_prefer_server_ciphers on;
  ssl_dhparam /etc/nginx/ssl/dhp-2048.pem;</span>
  [...]</code></pre>

The Let's Encrypte certificates are good for 90 days and can be automatically renewed.  To automatically request a renewal once a week, edit the crontab file for root.

~~~
# crontab -e
~~~

And add the following two lines at the bottom:

~~~
30 2 * * 1 /usr/bin/letsencrypt renew >> /var/log/le-renew.log
35 2 * * 1 /bin/systemctl reload nginx
~~~

These two directives will execute the letsencrypt-auto renew command every Monday at 2:30 am, and then reload Nginx at 2:35am (so the renewed certificate will be used). The output will be piped to a log file located at /var/log/le-renewal.log, so you can always check it later.

To finish the SSL configuration, continue with the steps at [Configure FreeSWITCH to user WebRTC](#configure-freeswitch-for-using-webrtc).



# Configuring BigBlueButton behind a firewall

## Updating FreeSWITCH configuration

As described in the introduction, a common setup is to have your BigBlueButton server behind a firewall (either virtual or physical).  In this configuration, the network setup resembles the following diagram (yours would have different IP address of course).

![Install](/images/11-install-net2.png)

For WebRTC audio to work, you need to change the configuration of FreeSWITCH to listen for connections on the external IP address of the firewall.  If you haven't modified your firewall to forward ports to your BigBlueButton server, see [configure a firewall](#configuring-your-firewall).

With the firewall configured to forward incoming connections to the BigBlueButton server, the next step is to configure FreeSWITCH to bind to the firewall's external IP address.

Edit the following files and substitute EXTERNAL\_IP\_ADDRESS for the external IP address (not the external hostname).

Edit `/opt/freeswitch/conf/vars.xml`, and change

~~~
<X-PRE-PROCESS cmd="set" data="bind_server_ip=auto"/>
~~~

To

~~~
<X-PRE-PROCESS cmd="set" data="bind_server_ip=EXTERNAL_IP_ADDRESS"/>
~~~

Change

~~~
<X-PRE-PROCESS cmd="set" data="external_rtp_ip=stun:stun.freeswitch.org"/>
~~~

To

~~~
<X-PRE-PROCESS cmd="set" data="external_rtp_ip=EXTERNAL_IP_ADDRESS"/>
~~~

Change

~~~
<X-PRE-PROCESS cmd="set" data="external_sip_ip=stun:stun.freeswitch.org"/>
~~~

To

~~~
<X-PRE-PROCESS cmd="set" data="external_sip_ip=EXTERNAL_IP_ADDRESS"/>
~~~


Next, edit `/opt/freeswitch/conf/sip_profiles/external.xml` and change

~~~
    <param name="rtp-ip" value="$${local_ip_v4}"/>
    <param name="sip-ip" value="$${local_ip_v4}"/>
    <param name="ext-rtp-ip" value="$${local_ip_v4}"/>
    <param name="ext-sip-ip" value="$${local_ip_v4}"/>
~~~

to

~~~
    <param name="rtp-ip" value="$${local_ip_v4}"/>
    <param name="sip-ip" value="$${local_ip_v4}"/>
    <param name="ext-rtp-ip" value="$${external_rtp_ip}"/>
    <param name="ext-sip-ip" value="$${external_sip_ip}"/>
~~~

Next, edit `/opt/freeswitch/conf/sip_profiles/external.xml` and ensure the value for `wss-binding` uses the external IP address

~~~
<param name="wss-binding"  value="EXTERNAL_IP_ADDRESS:7443"/>
~~~


Next, edit `/usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties`, and make sure the values of `bbb.sip.app.ip` and `freeswitch.ip` have the internal IP address.

~~~
bbb.sip.app.ip=<internal_ip>
bbb.sip.app.port=5070

freeswitch.ip=<internal_ip>
freeswitch.port=5060
~~~

If you have not configured your server for SSL, edit `/etc/bigbluebutton/nginx/sip.nginx` to use port 7443 with the external IP address.

~~~
location /ws {
        proxy_pass http://EXTERNAL_IP_ADDRESS:5066;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_read_timeout 6h;
        proxy_send_timeout 6h;
        client_body_timeout 6h;
        send_timeout 6h;
}
~~~

If you have configured your server for SSL, edit `/etc/bigbluebutton/nginx/sip.nginx` to

~~~
location /ws {
        proxy_pass https://EXTERNAL_IP_ADDRESS:7443;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_read_timeout 6h;
        proxy_send_timeout 6h;
        client_body_timeout 6h;
        send_timeout 6h;
}
~~~

After making the above changes, restart BigBlueButton

~~~
# bbb-conf --restart
~~~

To test, launch FireFox and try connecting to your BigBlueButton server and join the audio.  If you see the words '[ WebRTC Audio ]' in the lower right-hand corner, it worked.

If it didn't work, there are two likely error messages when you try to connect with audio.  

Detected the following WebRTC issue: Error 1002: Could not make a WebSocket connection. Do you want to try Flash instead?

| ErrorDetected the following WebRTC issue | Probable Cause |
|------------------------------------------|----------------|
| 1002: Could not make a WebSocket connection | Note 1 |
| 1007: ICE negotiation failed | Note 2 |

For Error 1002, check IP address for `proxy_pass` in `/etc/bigbluebutton/nginx/sip.nginx` is pointing to the external IP address of the firewall.  Next, check that FreeSWITCH has started without errors

<pre><code># systemctl status freeswitch
● freeswitch.service - freeswitch
   Loaded: loaded (/lib/systemd/system/freeswitch.service; enabled; vendor preset: enabled)
   Active: <span style="color:#980000;font-weight:bold">active (running)</span> since Fri 2017-03-03 23:13:07 UTC; 48min ago
  Process: 19349 ExecStart=/opt/freeswitch/bin/freeswitch -u freeswitch -g daemon -ncwait $DAEMON_OPTS (code=exited, status=0/SUCCESS)
 Main PID: 19361 (freeswitch)
    Tasks: 36
   Memory: 41.4M
      CPU: 20.744s
   CGroup: /system.slice/freeswitch.service
           └─19361 /opt/freeswitch/bin/freeswitch -u freeswitch -g daemon -ncwait -nonat

Mar 03 23:13:05 t4 systemd[1]: Starting freeswitch...
Mar 03 23:13:05 t4 freeswitch[19349]: 19361 Backgrounding.
Mar 03 23:13:07 t4 freeswitch[19349]: FreeSWITCH[19349] Waiting for background process pid:19361 to be ready.....
Mar 03 23:13:07 t4 freeswitch[19349]: FreeSWITCH[19349] System Ready pid:19361
Mar 03 23:13:07 t4 systemd[1]: Started freeswitch.
</code></pre>

You should see `active (running)`.  If FreeSWITCH is not running, you can check it's output log for clues on why it's not running `journalctl -u freeswitch.service`.

For Error 1007, it means that the web socket connect was successful (FreeSWITCH is running and received the request from the browser to setup a media path), but none of the IP/Port combinations returned by FreeSWITCH enabled the browser to connect and start transmitting media.

When you see 1007, open `about:webrtc` in FireFox and click 'show details' for the most recent connection.  Look under the column `Remote Candidate` and check if you see the IP address of the firewall.  If not, read the next section about configuring a dummy NIC.

## Configure a dummy NIC (if required)

If you are encountering error 1007 when trying to connect to WebRTC audio, it might be that your firewall does not support "hairpin NAT", which means when the BigBlueButton server connects to the firewall's IP address, the firewall is not sending the connection right back.

You can test if hairpin NAT is working using following command on your BigBlueButton server. Replace `EXTERNAL_IP_ADDRESS` with the external IP address of your firewall.

~~~
# curl --trace-ascii - -k https://EXTERNAL_IP_ADDRESS:443/bigbluebutton/api
~~~

Here's the sample output from a success test.

~~~
~# curl --trace-ascii - -k https://203.0.113.1:443/bigbluebutton/api
== Info:   Trying 203.0.113.1...
== Info: Connected to 203.0.113.1 (203.0.113.1) port 443 (#0)
== Info: found 173 certificates in /etc/ssl/certs/ca-certificates.crt
== Info: found 692 certificates in /etc/ssl/certs
== Info: ALPN, offering http/1.1
== Info: SSL connection using TLS1.2 / ECDHE_RSA_AES_128_GCM_SHA256
== Info:         server certificate verification SKIPPED
== Info:         server certificate status verification SKIPPED
== Info:         common name: HOSTNAME (does not match '203.0.113.1')
== Info:         server certificate expiration date OK
== Info:         server certificate activation date OK
== Info:         certificate public key: RSA
== Info:         certificate version: #3
== Info:         subject: CN=bbb02.monasticeducation.net
== Info:         start date: Fri, 24 Feb 2017 06:20:00 GMT
== Info:         expire date: Thu, 25 May 2017 06:20:00 GMT
== Info:         issuer: C=US,O=Let's Encrypt,CN=Let's Encrypt Authority X3
== Info:         compression: NULL
== Info: ALPN, server accepted to use http/1.1
=> Send header, 93 bytes (0x5d)
0000: GET /bigbluebutton/api HTTP/1.1
0021: Host: 203.0.113.1
0035: User-Agent: curl/7.47.0
004e: Accept: */*
005b:
<= Recv header, 17 bytes (0x11)
...
<response><returncode>SUCCESS</returncode><version>1.0</version></response>== Info: Connection #0 to host 203.0.113.1 left intact
~~~

You should see the `<response>...</response>` at the end.  

If you don't see this, follow the steps below on your BigBlueButton server to setup a dummy NIC that has the same IP address as your firewall.  Here's a sample diagram of how it works.

![Install](/images/11-install-net3.png)

In this diagram, we've setup a dummy NIC for 203.0.113.1, which will allow FreeSWITCH to connect back to itself.  This way, when an incoming connection comes from the firewall (which is also on 203.0.113.1), FreeSWITCH will present to the remote browser the IP address of 203.0.113.1 for a candidate for the media path.

To setup a dummy NIC, on your BigBlueButton enter the following command and substitute `EXTERNAL_IP_ADDRESS` with the external IP address of your firewall.

~~~
sudo ip addr add  EXTERNAL_IP_ADDRESS/32 dev lo
~~~

Next, check that the dummy NIC was created using the command `ip addr`.

~~~
# ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet EXTERNAL_IP_ADDRESS/32 scope global lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
~~~

You should see the EXTERNAL_IP_ADDRESS for your firewall listed above.

Next, edit `/opt/freeswitch/conf/sip_profiles/external.xml` to bind to the external IP address.

<pre><code>    &lt;param name="tls-version" value="$${sip_tls_version}"/&gt;
    <span style="color:#980000;font-weight:bold">&lt;param name="wss-binding" value="EXTERNAL_IP_ADDRESS:7443"/&gt;</span></code></pre>

Restart your BigBlueButton server and test again with curl to access the EXTERNAL_IP_ADDRESS on port 443 from your BigBlueButton server.

~~~
# bbb-conf --restart
# curl --trace-ascii - -k https://EXTERNAL_IP_ADDRESS:443/bigbluebutton/api
~~~

You should see the `<response>...</response>` at the end.

Finally, to ensure this dummy NIC to be automatically created on restart, edit `/etc/network/interfaces` and add the following


~~~
# The loopback network interface
auto lo
iface lo inet loopback
        post-up ip addr add EXTERNAL_IP_ADDRESS/32 dev lo
        pre-down ip addr del EXTERNAL_IP_ADDRESS/32 dev lo
~~~


# Upgrading BigBlueButton 1.1

The BigBlueButton project is very active and follows a [rigorous development process](#bigbluebutton-development-process) for each release.

When upgrades are available for BigBlueButton (usually announced to [bigbluebutton-dev](https://groups.google.com/forum/#!forum/bigbluebutton-dev)), you can update your server with the following commands (replacing `EXTERNAL_HOST_NAME` with the external hostname for your BigBlueButton server):

~~~
sudo apt-get update
sudo apt-get dist-upgrade

sudo bbb-conf --setip <IP_or_hostname>
sudo bbb-conf --check
~~~

The use of `sudo bbb-conf --setip` will ensure that all configuration files are updated with the servers hostname (or IP address if you are not using a hostname for your server).

# Troubleshooting Installation

This section will help you resolve common errors with installation of BigBlueButton.  If you are unable to resolve any installation issues, post a description of the error message along with the version of BigBlueButton you are installing to [bigbluebutton-setup](http://groups.google.com/group/bigbluebutton-setup/topics?gvc=2) and the community can help you further.

## Run sudo bbb-conf --check

We've built in a BigBlueButton configuration utility, called `bbb-conf`, to help you configure your BigBlueButton server and troubleshoot your setup if something doesn't work right.

If you think something isn't working correctly, the first step is enter the following command.

~~~
$ sudo bbb-conf --check
~~~

This will check your setup to ensure the correct processes are running, the BigBlueButton components have correctly started, and look for common configuration problems that might prevent BigBlueButton from working properly.

If you see text after the line `** Potential problems described below **`, then it may be warnings (which you can ignore if you've change settings) or errors with the setup.


## Could not get your microphone for a WebRTC call

Chrome requires (As of Chrome 47) that to access the user's microphone for WebRTC your site must be serving pages via HTTPS (that is, nginx is configured with a SSL certificate).

If the user attempts to share their microphone and your BigBlueButton sever is not configured for SSL, Chrome will block access and BigBlueButton will report the following error

   _WebRTC Audio Failure: Detected the following WebRTC issue: Could not get your microphone for a WebRTC call. Do you want to try flash instead?_

To enable Chrome to access the user's microphone, see [Configuring HTTPS on BigBlueButton](#configuring-ssl-on-your-bigbluebutton-server).


## Tomcat7 takes a long time to startup

Tomcat relies on the SecureRandom class (which uses available entropy) to provide random values for its session IDs.  On a virtualized server, however, the available entropy can run low and cause tomcat7 to block for a long period before it finishes it's startup sequence (see [Tomcat Entropy Source](http://wiki.apache.org/tomcat/HowTo/FasterStartUp#Entropy_Source)).

To provide tomcat7 with more entropy, you can install haveged

~~~
$ sudo apt-get install haveged
~~~

For more information see [How to Setup Additional Entropy for Cloud Servers Using Haveged](https://www.digitalocean.com/community/tutorials/how-to-setup-additional-entropy-for-cloud-servers-using-haveged).


## Errors with packages

Some hosting providers do not provide a complete `/etc/apt/source.list`.  If you are finding your are unable to install a package, try replacing your `/etc/apt/sources.list` with the following


~~~
deb http://archive.ubuntu.com/ubuntu xenial main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu xenial-updates main restricted universe multiverse
deb http://security.ubuntu.com/ubuntu xenial-security main restricted universe multiverse

~~~

then do

~~~
$ sudo apt-get update
~~~

and try installing BigBlueButton again from the beginning.


## Welcome to nginx

During installation of BigBlueButton the packaging scripts attempt to assign the correct IP address during setup. However, if the IP address changes (such as when rebooting a VM), or the first IP address was not the correct IP address for the server, you may see a "Welcome to nginx" page.  

To reconfigure the BigBlueButton to use the correct IP address or hostname, see [BigBlueButton does not load](#bigbluebutton-does-not-load).

## BigBlueButton does not load

If your has changed it's network connection (such as on reboot), you can most of BigBlueButton's configuration files with the following steps.

~~~
$ sudo bbb-conf --setip <ip_address_or_hostname>

$ sudo bbb-conf --clean
$ sudo bbb-conf --check
~~~

For more information see [bbb-conf options](/install/bbb-conf.html).

## Conference not found errors

The command `sudo bbb-conf --debug` searches through the red5, tomcat7, and nginx logs looking for errors and exceptions.  However, the messages such as

~~~
    -- ERRORS found in /usr/share/red5/log/* --
/usr/share/red5/log/bigbluebutton.log:2015-05-02 13:50:37,681-04:00 [pool-17-thread-1] ERROR o.b.w.v.f.a.PopulateRoomCommand - Not XML: [Conference 78505 not found]
~~~

are innocious and can be ignored.


## No Symbolic Link

If you've installed/uninstalled BigBlueButton packages, you may get a `No Symbolic Link` warning from `bbb-conf --check`:

~~~
** Potential Problems **
    nginx (conf): no symbolic link in /etc/nginx/sites-enabled for bigbluebutton
~~~

To solve this,  add a symbolic link to nginx for the BigBlueButton site:

~~~
$ sudo ln -s /etc/nginx/sites-available/bigbluebutton /etc/nginx/sites-enabled/bigbluebutton
$ sudo /etc/init.d/nginx restart
~~~

## Users not able to join Listen Only mode
When doing `sudo bbb-conf --check`, you may see the warning

~~~
voice Application failed to register with sip server
~~~

This error occurs when `bbb-apps-sip` isn't able to make a SIP call to FreeSWITCH.  You'll see this in BigBlueButton when users click the headset icon and don't join the voice conference.

One possible cause for this is you have just installed BigBlueButton, but not restarted it.  The packages do not start up the BigBlueButton components in the right order.  To restart BigBlueButton, do the following:

~~~
$ sudo bbb-conf --restart
$ sudo bbb-conf --check
~~~

If you don't want FreeSWITCH to bind to 127.0.0.1, you need to figure out which IP address its using.  First, determine the IP address FreeSWITCH is monitoring for incoming SIP calls with the following command:

~~~
$ netstat -ant | grep 5060
~~~

You should see an output such as

~~~
tcp        0      0 234.147.116.3:5060    0.0.0.0:*               LISTEN
~~~

In this example, FreeSWITCH is listening on IP address 234.147.116.3.  The IP address on your server will be different.

Next, edit `/usr/share/red5/webapps/sip/WEB-INF/bigbluebutton-sip.properties` and set the value for `sip.server.host` to the IP address returned from the above command.   Save the changes (you'll need to edit the file as root to save changes).

Restart BigBlueButton using the commands and run the built-in diagnostics checks.

~~~
$ sudo bbb-conf --clean
$ sudo bbb-conf --check
~~~

## Client WebRTC Error Codes

WebRTC offers very high-quality audio.  However, the user's network settings (or firewall) may not allow WebRTC to connect (or keep connected).

Here are the following lists the possible WebRTC error messages that a user may encounter:

  * **1001: WebSocket disconnected** - The WebSocket had connected successfully and has now disconnected.  Possible Causes:
    * Loss of internet connection
    * Nginx restarting can cause this
  * **1002: Could not make a WebSocket connection** - The initial WebSocket connection was unsuccessful.  Possible Causes:
    * Firewall blocking ws protocol
    * Server is down or improperly configured
  * **1003: Browser version not supported** - Browser doesn’t implement the necessary WebRTC API methods.  Possible Causes:
    * Out of date browser
  * **1004: Failure on call** - The call was attempted, but failed.  Possible Causes:
    * For a full list of causes refer here, http://sipjs.com/api/0.6.0/causes/
    * There are 24 different causes so I don’t really want to list all of them
  * **1005: Call ended unexpectedly** - The call was successful, but ended without user requesting to end the session.  Possible Causes:
    * Unknown
  * **1006: Call timed out** - The library took too long to try and connect the call.  Possible Causes:
    * Previously caused by Firefox 33-beta on Mac.   We've been unable to reproduce since release of FireFox 34
  * **1007: ICE negotiation failed** - The browser and FreeSWITCH try to negotiate ports to use to stream the media and that negotiation failed.  Possible Causes:
    * NAT is blocking the connection
    * Firewall is blocking the UDP connection/ports
  * **1008: Call transfer failed** - A timeout while waiting for FreeSWITCH to transfer from the echo test to the real conference. This might be caused by a misconfiguration in FreeSWITCH, or there might be a media error and the DTMF command to transfer didn't go through (In this case, the voice in the echo test probably didn't work either.)
  * **1009: Could not fetch STUN/TURN server information** - This indicates either a BigBlueButton bug (or you're using an unsupported new client/old server combination), but could also happen due to a network interruption.

## Not running: nginx

The common reasons for nginx not running are inability to bind to port 80 and configuration errors.  To check if port 80 is already in use, use

~~~
$ sudo netstat -ant
~~~

to see if any process is currently bound to port 80.  If so, check to see if another web server is installed.  If so, then stop the web server and try to restart nginx.  One of the server requirements before you install BigBlueButton is that port 80 is not in use by another application (such as Apache).  For details on why this is a requirements, see [We recommend running BigBlueButton on port 80](http://docs.bigbluebutton.org/support/faq.html#we-recommend-running-bigbluebutton-on-port-80).


If port 80 is free, check if your nginx configuration file has errors.  Try a restart of nginx

~~~
$ sudo systemctl restart nginx
~~~

and look for the output of

~~~
   [ OK ]
~~~

If you see `[ Fail ]`, then your nginx configuration files might have a syntax error.  Check the syntax of the nginx configuration files using the command

~~~
$ sudo nginx -t
~~~

and see if it repots any errors.  You can also check the error.log file for nginx to see what errors it gives on startup

~~~
$ sudo cat /var/log/nginx/error.log
~~~



## Importing recordings from older server

There are two ways of importing recordings from an old BigBlueButton server to a new one; they are described separately.

## Transfer existing published recordings

If you want to do the minimum amount of work to quickly make your existing recordings on an older BigBlueButton server, transfer the contents of the `/var/bigbluebutton/published` and `/var/bigbluebutton/unpublished` directories. In addition, to preserve the backup of the original raw media, you should transfer the contents of the `/var/bigbluebutton/recording/raw` directory.

Here is an example set of rsync commands that would accomplish this; run these on the new server to copy the files from the old server.

~~~
$ rsync -rP root@old-bbb-server:/var/bigbluebutton/published/ /var/bigbluebutton/published/
$ rsync -rP root@old-bbb-server:/var/bigbluebutton/unpublished/ /var/bigbluebutton/unpublished/
$ rsync -rP root@old-bbb-server:/var/bigbluebutton/recording/raw/ /var/bigbluebutton/recording/raw/
~~~

Other methods of transferring these files can also be used; for example, you could create a tar archive of each of the directories, and transfer it via scp, or use a shared NFS mount.

You will then need to fix the permissions on the newly copied recordings:

~~~
chown -R tomcat7:tomcat7 /var/bigbluebutton/published /var/bigbluebutton/unpublished /var/bigbluebutton/recording/raw
~~~

If the recordings were copied from a server with a different hostname, you will have to run the following command to fix the stored hostnames. (If you don't do this, it'll either return a 404 error, or attempt to load the recordings from the old server instead of the new server!)

Note that this command will restart the BigBlueButton server, interrupting any live sessions.

~~~
$ bbb-conf --setip <ip_address_or_hostname>
~~~

For example,

~~~
$ bbb-conf --setip bigbluebutton.example.com
~~~

The transferred recordings should be immediately visible via the BigBlueButton recordings API.

### Re-process raw recordings

This is the recommended way of copying recordings, since the recordings will be rebuilt using newer versions of the recording software, enabling new features and fixing bugs that may have been present with the old version. The downside is that this can take a long time, and will use a lot of CPU on your new BigBlueButton server while you wait for the recordings to process.

If your old server has all of the original recording files in the `/var/bigbluebutton/recording/raw` directory, then you can transfer these files to the new server, for example with rsync:

This example rsync command could be run on the new server, and will copy the recording file from the old server.

~~~
$ rsync -rP root@old-bbb-server:/var/bigbluebutton/recording/raw/ /var/bigbluebutton/recording/raw/
~~~

There are other ways of transferring these files; for example, you could create a tar archive of the `/var/bigbluebutton/recording/raw` directory, and copy it with scp, or use a shared NFS mount. Any method should work fine.

You will then need to fix the permissions on the newly copied recordings:

~~~
$ chown -R tomcat7:tomcat7 /var/bigbluebutton/recording/raw
~~~

And initiate the recording re-processing

~~~
$ bbb-record --rebuildall
~~~

The BigBlueButton server will automatically go through the recordings and rebuild and publish them. You can use the `bbb-record --watch` command to see the progress.


## Running within an LXD Container

[LXD](https://www.ubuntu.com/containers/lxd) is a very powerful container system for Ubuntu lets you run full Ubuntu 16.04 servers within a container.  Because you can easily clone and snapshot LXD containers, they are ideal for development and testing of BigBlueButton.

However, if you install BigBlueButton within an LXD container, you will get the following error from `sudo bbb-conf --check`

~~~
** Potential problems described below **

#
# Error: Unable to connect to the FreeSWITCH Event Socket Layer on port 8021
~~~

This error occurs because the default systemd unit script for FreeSWITCH tries to run with permissions not available to the LXD container.  To run FreeSWITCH within an LXD container, edit `/lib/systemd/system/freeswitch.service` and replace with the following

~~~
[Unit]
Description=freeswitch
After=syslog.target network.target local-fs.target

[Service]
Type=forking
PIDFile=/opt/freeswitch/var/run/freeswitch/freeswitch.pid
Environment="DAEMON_OPTS=-nonat"
EnvironmentFile=-/etc/default/freeswitch
ExecStart=/opt/freeswitch/bin/freeswitch -u freeswitch -g daemon -ncwait $DAEMON_OPTS
TimeoutSec=45s
Restart=always
WorkingDirectory=/opt/freeswitch
User=freeswitch
Group=daemon

[Install]
WantedBy=multi-user.target
~~~

Then enter the following commands to load the new unit file and restart BigBlueButton.

~~~
# sudo systemctl daemon-reload
# sudo bbb-conf --restart
~~~

You can run BigBlueButton within a LXD container.


## Root partition too small

If the root partition on your BigBlueButton server is too small (for disk space requirements see [Before you install](#before-you-install)), we recommend moving the following directories to an external partition with sufficent disk space.

BigBlueButton processing and storage of recordings:

~~~
  /var/bigbluebutton
~~~

FreeSWITCH recording of audio files:

~~~
  /var/freeswitch/meetings
~~~

And red5 recording of video files:

~~~
  /usr/share/red5/webapps/video/streams
~~~

To make the move, first stop BigBlueButton, then move the above directories to a new location on the external partition, create symbolic links from the original locations to the new locations, and restart BigBlueButton.

## Unable to create presentation

If you see the following error in `/var/bigbluebutton/bbb-web.log`

~~~
  failed to map segment from shared object: Operation not permitted
~~~

use the command `mount` to check that the `/tmp` director does not have `noexec` permissions (which would prevent executables from running in the /tmp directory). If you see `noexec` for `/tmp`, you need to remount the directory with permissions that enable processes (such as the slide conversion) to execute in the `/tmp` directory.
